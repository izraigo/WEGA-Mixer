<!DOCTYPE html>
<link rel='stylesheet' type='text/css' href='style.css'>
Current scale_calibration_A=<span id="curA"></span>, scale_calibration_B=<span id="curB"></span>
<ol>
    <li>Unload scales and press <input type='button' onclick="tare();" value='Set to ZERO'/> <b id='tareOk'></b></li>
    <li>Take any object of known weight. Enter its weight here <input type='text' id='knownValue'/></li>
    <li>Place the weight on point A and press <input type='button' onclick="calc('A');" value="Ok"/> <b id='A'></b></li>
    <li>Place the weight on point B and press <input type='button' onclick="calc('B');"value="Ok"/> <b id='B'></b></li>
    <li>Open <b>mixer.ino</b> and set values for the constants</li>
</ol>
Test:
<ol>
    <li>Enter scale <input type='text' id='testScale'/> and press <input type='button' onclick="test();" value='Test'/></li>
    <li>Measured weight is <span id='testVal'>_</span></li>
</ol>
<p><input type='button' onclick="location.href = '/';" value='Home'/></p>
ver : <span id='version'>unknown</span>    
<script>
function loadMeta() {
    fetch("/rest/meta").then(r => r.json()).then(r => {
        document.getElementById("version").textContent = r.version;
        document.getElementById("curA").textContent = r.scalePointA;        
        document.getElementById("curB").textContent = r.scalePointB;        
    })
    .catch(e => setTimeout(loadMeta, 1000));
}

function tare() {
    document.getElementById("tareOk").textContent = "Wait";
    fetch("/rest/tare")
    .then(r => {
        if (r.ok) return document.getElementById("tareOk").textContent = "Ok";
        throw new Error('Busy try later');
    })
    .catch(e => document.getElementById("tareOk").textContent = e);
}

function calc(point) {
    fetch("/rest/measure")
    .then(r => {
        if (r.ok) return r.json();
        throw new Error('Busy try later');
    })
    .then(r => {
        let knownValue = document.getElementById('knownValue').value;
        let result = (r.rawValue - r.rawZero) / knownValue;
        document.getElementById(point).textContent = ' scale_calibration_' + point + ' = ' + result;
    })
    .catch(e => document.getElementById(point).textContent = e);
}

function test(point) {
    fetch("/rest/measure")
    .then(r => {
        if (r.ok) return r.json();
        throw new Error('Busy try later');
    })
    .then(r => {
        let scale = document.getElementById('testScale').value;
        document.getElementById("testVal").textContent = (r.rawValue - r.rawZero) / scale;
    })
    .catch(e => document.getElementById("testVal").textContent = e);
}

loadMeta();
</script>
